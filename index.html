<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocBook - Beauty Salon & Center Booking</title>
    <link rel="stylesheet" href="style.css?v=1.2">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="app.js?v=1.2"></script>
    <!-- Google Maps API -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAfPTJjw9HiF5yc99hn3SyRSpNVfB2wmMk&callback=initMapCallback"></script>
</head>

<body>
    <header>
        <div class="container">
            <div class="logo">DocBook ‚ú®</div>
            <nav>
                <a href="#home" class="nav-link">Home</a>
                <a href="#explore" class="nav-link">Explore</a>
                <button id="map-btn" class="btn-outline"
                    style="background: linear-gradient(135deg, #f3e8ff, #e0aaff); border: none;">üìç Map</button>
                <button id="login-btn" class="btn-outline">Login</button>
                <div id="user-profile" style="display: none; align-items: center; gap: 10px;">
                    <span id="user-name" style="font-weight: 500;"></span>
                    <button onclick="handleLogout()" class="btn-link"
                        style="color: #666; font-size: 0.9rem;">Logout</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- CUSTOMER DASHBOARD -->
    <main id="dashboard-customer">
        <section id="home" class="hero">
            <div class="container">
                <h1>Discover Beauty Salons & Centers</h1>
                <p>Book appointments at the best salons and beauty centers in your city.</p>
                <div class="search-bar">
                    <input type="text" placeholder="Search for services (e.g. Haircut, Botox)...">
                    <button class="btn-primary">Search</button>
                </div>
            </div>
        </section>
        <!-- SPONSOR BANNER AREA -->
        <section id="sponsor-banner" class="sponsor-section">
            <div class="container">
                <div class="sponsor-carousel" id="sponsor-carousel">
                    <!-- Sponsors loaded via JS -->
                </div>
            </div>
        </section>

        <section id="explore" class="content-section">
            <div class="container">
                <div class="section-header">
                    <h2>Top Rated Venues</h2>
                    <div class="filters">
                        <button class="filter-chip active" data-type="all">All</button>
                        <button class="filter-chip" data-type="salon">Salons</button>
                        <button class="filter-chip" data-type="beauty_center">Beauty Centers</button>
                    </div>
                </div>

                <div id="merchants-grid" class="grid">
                    <!-- Merchants loaded via JS -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
        </section>
    </main>

    <!-- OWNER DASHBOARD -->
    <main id="dashboard-owner" style="display: none;">
        <div class="container">
            <div class="dashboard-header">
                <h1>Owner Dashboard</h1>
                <div id="owner-store-badge" class="filter-chip active"
                    style="background: var(--primary); color: white;">Loading...</div>
            </div>

            <!-- Owner Tabs -->
            <div class="admin-tabs">
                <button class="owner-tab active" data-tab="overview">üìä Overview</button>
                <button class="owner-tab" data-tab="bookings">üìÖ Bookings</button>
                <button class="owner-tab" data-tab="mystore">üè™ My Store</button>
                <button class="owner-tab" data-tab="financials">üí∞ Financials</button>
            </div>

            <!-- OVERVIEW TAB -->
            <div id="owner-overview" class="owner-panel">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Today's Bookings</h3>
                        <p class="stat-num" id="owner-stat-today">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Pending Requests</h3>
                        <p class="stat-num" id="owner-stat-pending" style="color: #eab308;">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Revenue</h3>
                        <p class="stat-num" id="owner-stat-revenue">$0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Rating</h3>
                        <p class="stat-num" id="owner-stat-rating">‚≠ê 5.0</p>
                    </div>
                </div>
                <div class="appointments-list">
                    <h3>Action Required (Pending Bookings)</h3>
                    <div id="owner-urgent-bookings-list">
                        <div class="empty-state">No pending bookings.</div>
                    </div>
                </div>
            </div>

            <!-- BOOKINGS TAB -->
            <div id="owner-bookings" class="owner-panel" style="display: none;">
                <div class="panel-header">
                    <h2>Booking Management</h2>
                    <div class="filters">
                        <button class="filter-btn active" onclick="filterOwnerBookings('all')">All</button>
                        <button class="filter-btn" onclick="filterOwnerBookings('pending')">Pending</button>
                        <button class="filter-btn" onclick="filterOwnerBookings('confirmed')">Confirmed</button>
                        <button class="filter-btn" onclick="filterOwnerBookings('completed')">Completed</button>
                    </div>
                </div>
                <div class="admin-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th>Service</th>
                                <th>Date/Time</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="owner-bookings-tbody">
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- MY STORE TAB -->
            <div id="owner-mystore" class="owner-panel" style="display: none;">
                <div class="panel-header">
                    <h2>Edit Store Details</h2>
                    <button class="btn-primary" onclick="saveOwnerStoreDetails()">üíæ Save Changes</button>
                </div>

                <div class="store-edit-container"
                    style="background: white; padding: 20px; border-radius: 12px; box-shadow: var(--shadow);">
                    <!-- Reusing the form inputs but with different IDs for owner context -->
                    <form id="owner-store-form" onsubmit="event.preventDefault(); saveOwnerStoreDetails();">
                        <div class="form-group">
                            <label>Store Name</label>
                            <input type="text" id="owner-store-name" required>
                        </div>
                        <div class="form-group">
                            <label>Address</label>
                            <input type="text" id="owner-store-address" required>
                        </div>
                        <div class="form-group">
                            <label>Store Photo</label>
                            <div class="photo-upload-container">
                                <img id="owner-store-photo-preview" src="" alt="Store Preview"
                                    style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px; display: none; margin-bottom: 10px; background: #eee;">
                                <input type="file" id="owner-store-photo-file" accept="image/*" class="file-input">
                                <input type="hidden" id="owner-store-photo">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Latitude</label>
                                <input type="number" id="owner-store-lat" step="any" readonly
                                    style="background: #f3f4f6;">
                            </div>
                            <div class="form-group">
                                <label>Longitude</label>
                                <input type="number" id="owner-store-lng" step="any" readonly
                                    style="background: #f3f4f6;">
                            </div>
                            <div class="form-group" style="display: flex; align-items: flex-end;">
                                <button type="button" class="btn-secondary" onclick="openLocationPickerForOwner()"
                                    style="margin-bottom: 2px;">üìç Update Location</button>
                            </div>
                        </div>

                        <!-- Services Section for Owner -->
                        <div class="section-divider"></div>
                        <h3>üìã Services</h3>
                        <div id="owner-services-list" class="sortable-list">
                            <!-- Populated via JS -->
                        </div>
                        <button type="button" class="btn-add-service" onclick="openAddServiceModalForOwner()">
                            ‚ûï Add New Service
                        </button>
                    </form>
                </div>
            </div>

            <!-- FINANCIALS TAB -->
            <div id="owner-financials" class="owner-panel" style="display: none;">
                <div class="panel-header">
                    <h2>Financial Overview</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Earnings</h3>
                        <p class="stat-num" id="owner-fin-total">0 IQD</p>
                        <span class="stat-trend">Gross Revenue</span>
                    </div>
                    <div class="stat-card highlight">
                        <h3>Commission Due</h3>
                        <p class="stat-num" id="owner-fin-due">0 IQD</p>
                        <span class="stat-trend">To Platform (10%)</span>
                    </div>
                </div>

                <div class="invoices-section">
                    <h3>üìÑ Invoices from DocBook</h3>
                    <div id="owner-invoices-list" class="invoices-list">
                        <!-- Loaded via JS -->
                        <div class="empty-state">No invoices yet.</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ADMIN DASHBOARD -->
    <main id="dashboard-admin" style="display: none;">
        <div class="container">
            <div class="dashboard-header">
                <h1>üëë Admin Dashboard</h1>
            </div>

            <!-- Admin Tabs -->
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="stores">üè™ Stores</button>
                <button class="admin-tab" data-tab="offers">üéÅ Offers</button>
                <button class="admin-tab" data-tab="sponsors">üì∞ Sponsors</button>
                <button class="admin-tab" data-tab="financials">üí∞ Financials</button>
                <button class="admin-tab" data-tab="users">üë• Users</button>
            </div>

            <!-- USERS TAB -->
            <div id="admin-users" class="admin-panel" style="display: none;">
                <div class="panel-header">
                    <h2>User Management</h2>
                    <div class="filters">
                        <button class="filter-btn active" onclick="filterUsers('all')">All</button>
                        <button class="filter-btn" onclick="filterUsers('customer')">Customers</button>
                        <button class="filter-btn" onclick="filterUsers('owner')">Owners</button>
                        <button class="filter-btn" onclick="filterUsers('admin')">Admins</button>
                    </div>
                </div>
                <div class="admin-table-container">
                    <table class="admin-table" id="users-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Role</th>
                                <th>Assigned Store</th>
                                <th>Joined</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody">
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- STORES TAB -->
            <div id="admin-stores" class="admin-panel">
                <div class="panel-header">
                    <h2>Store Management</h2>
                    <button class="btn-primary" onclick="openCreateStoreModal()">
                        + Create New Store
                    </button>
                </div>
                <div class="admin-table-container">
                    <table class="admin-table" id="stores-table">
                        <thead>
                            <tr>
                                <th>Store Name</th>
                                <th>Category</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="stores-tbody">
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- OFFERS TAB -->
            <div id="admin-offers" class="admin-panel" style="display: none;">
                <div class="panel-header">
                    <h2>Offers & Promotions</h2>
                    <button class="btn-primary" onclick="openCreateOfferModal()">
                        + New Offer
                    </button>
                </div>
                <div class="admin-table-container">
                    <table class="admin-table" id="offers-table">
                        <thead>
                            <tr>
                                <th>Store</th>
                                <th>Service</th>
                                <th>Discount</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="offers-tbody">
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- SPONSORS TAB -->
            <div id="admin-sponsors" class="admin-panel" style="display: none;">
                <div class="panel-header">
                    <h2>Sponsor Management</h2>
                    <button class="btn-primary" onclick="openCreateSponsorModal()">
                        + Add Sponsor
                    </button>
                </div>

                <div class="sponsor-type-section">
                    <h3>üè™ Sponsored Stores</h3>
                    <p>Featured stores will appear in the sponsor banner on the homepage.</p>
                    <div id="sponsored-stores-list" class="sponsored-items-grid">
                        <!-- Loaded via JS -->
                    </div>
                </div>

                <div class="sponsor-type-section">
                    <h3>üì∞ External Advertisements</h3>
                    <p>External ads/banners that link outside the website.</p>
                    <div id="external-ads-list" class="sponsored-items-grid">
                        <!-- Loaded via JS -->
                    </div>
                </div>
            </div>

            <!-- FINANCIALS TAB -->
            <div id="admin-financials" class="admin-panel" style="display: none;">
                <div class="panel-header">
                    <h2>üí∞ Financial Overview</h2>
                    <div class="financial-filters">
                        <button class="filter-btn active" data-range="today">Today</button>
                        <button class="filter-btn" data-range="week">This Week</button>
                        <button class="filter-btn" data-range="month">This Month</button>
                        <button class="filter-btn" data-range="all">All Time</button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="financial-stats">
                    <div class="financial-stat-card">
                        <span class="stat-label">Total Revenue</span>
                        <span class="stat-value" id="stat-total-revenue">0 IQD</span>
                        <span class="stat-trend up">‚Üë All completed bookings</span>
                    </div>
                    <div class="financial-stat-card highlight">
                        <span class="stat-label">Commission Earned (10%)</span>
                        <span class="stat-value" id="stat-commission">0 IQD</span>
                        <span class="stat-trend">Your platform earnings</span>
                    </div>
                    <div class="financial-stat-card warning">
                        <span class="stat-label">Pending Payouts</span>
                        <span class="stat-value" id="stat-pending">0 IQD</span>
                        <span class="stat-trend">Awaiting completion</span>
                    </div>
                    <div class="financial-stat-card">
                        <span class="stat-label">This Month</span>
                        <span class="stat-value" id="stat-this-month">0 IQD</span>
                        <span class="stat-trend">Commission this month</span>
                    </div>
                </div>

                <!-- Invoice Generation -->
                <div class="invoice-generator">
                    <h3>üìÑ Generate Commission Invoice</h3>
                    <div class="invoice-controls">
                        <div class="form-group">
                            <label>Select Store</label>
                            <select id="invoice-store-select">
                                <option value="">-- Select a Store --</option>
                                <!-- Populated via JS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>From Date</label>
                            <input type="date" id="invoice-start-date">
                        </div>
                        <div class="form-group">
                            <label>To Date</label>
                            <input type="date" id="invoice-end-date">
                        </div>
                        <button class="btn-primary" onclick="generateStoreInvoice()">Generate Invoice</button>
                    </div>
                </div>

                <!-- Unpaid Invoices Section -->
                <div class="invoices-section">
                    <h3>‚è≥ Unpaid Invoices</h3>
                    <p class="section-desc">Pending commission payments from stores</p>
                    <div id="unpaid-invoices-list" class="invoices-list">
                        <!-- Populated via JS -->
                        <div class="empty-state">No unpaid invoices</div>
                    </div>
                </div>

                <!-- Paid Invoices Section -->
                <div class="invoices-section paid">
                    <h3>‚úÖ Paid Invoices</h3>
                    <p class="section-desc">Completed commission payments - no action required</p>
                    <div id="paid-invoices-list" class="invoices-list">
                        <!-- Populated via JS -->
                        <div class="empty-state">No paid invoices yet</div>
                    </div>
                </div>

                <!-- Bookings Table -->
                <div class="admin-table-container">
                    <h3>Recent Completed Bookings</h3>
                    <table class="admin-table" id="financials-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Store</th>
                                <th>Service</th>
                                <th>Amount</th>
                                <th>Commission (10%)</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="financials-tbody">
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- AUTH MODAL -->
    <div id="auth-modal" class="modal">
        <div class="modal-content auth-box">
            <span class="close" onclick="closeModal('auth-modal')">&times;</span>

            <!-- HEADER -->
            <div id="auth-header" style="text-align: center; margin-bottom: 20px;">
                <h2>Welcome to DocBook</h2>
                <p id="auth-subtitle" style="color: #666; font-size: 0.95rem;">Join the platform beauty lovers trust.
                </p>
            </div>

            <!-- STEP 0: CHOICE -->
            <div id="auth-step-0">
                <p style="text-align: center; margin-bottom: 20px; font-weight: 500; font-size: 1.1rem;">
                    It is very easy and very fast to create an account! üöÄ
                </p>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button class="btn-primary full-width" onclick="showAuthStep('register')">Create New
                        Account</button>
                    <button class="btn-outline full-width" onclick="showAuthStep('login')">Sign In</button>
                </div>

            </div>

            <!-- STEP 1: REGISTER -->
            <form id="auth-form-register" style="display: none;">
                <h3 style="margin-bottom: 15px;">Create Account</h3>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="reg-name" placeholder="Enter your full name" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <div class="phone-input-group"
                        style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 8px; padding: 2px 10px;">
                        <span style="font-weight: 600; color: #333; margin-right: 8px;">üáÆüá∂ +964</span>
                        <input type="tel" id="reg-phone" placeholder="750xxxxxxx" required
                            style="border: none; outline: none; flex: 1; padding: 10px 0;">
                    </div>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="reg-password" placeholder="Create a password" required>
                </div>
                <button type="submit" class="btn-primary full-width">Verify & Create Account</button>
                <p style="text-align: center; margin-top: 15px; font-size: 0.9rem;">
                    Already have an account? <a href="#" onclick="showAuthStep('login')">Sign In</a>
                </p>
            </form>

            <!-- STEP 1: LOGIN -->
            <form id="auth-form-login" style="display: none;">
                <h3 style="margin-bottom: 15px;">Sign In</h3>
                <div class="form-group">
                    <label>Phone Number</label>
                    <div class="phone-input-group"
                        style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 8px; padding: 2px 10px;">
                        <span style="font-weight: 600; color: #333; margin-right: 8px;">üáÆüá∂ +964</span>
                        <input type="tel" id="login-phone" placeholder="750xxxxxxx" required
                            style="border: none; outline: none; flex: 1; padding: 10px 0;">
                    </div>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn-primary full-width">Sign In</button>
                <p style="text-align: center; margin-top: 15px; font-size: 0.9rem;">
                    Don't have an account? <a href="#" onclick="showAuthStep('register')">Register</a>
                </p>
            </form>

            <!-- OWNER LOGIN Removed (Unified) -->
            <form id="auth-form-owner" style="display: none;">
                <!-- Deprecated -->
            </form>

            <div id="recaptcha-container"></div>

            <!-- STEP 2: VERIFICATION -->
            <form id="auth-form-verify" style="display: none;">
                <h3 style="margin-bottom: 15px;">Verify Phone</h3>
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                    Enter the code sent to <strong id="verify-phone-display">...</strong>
                </p>
                <div class="form-group">
                    <label>Verification Code</label>
                    <input type="text" id="auth-code" placeholder="123456"
                        style="text-align: center; letter-spacing: 5px; font-size: 1.2rem;" required>
                </div>
                <button type="submit" class="btn-primary full-width">Verify & Proceed</button>
                <button type="button" onclick="showAuthStep('back')" class="btn-link" style="margin-top: 10px;">Change
                    Phone Number</button>
            </form>
        </div>
    </div>

    <!-- BOOKING MODAL -->
    <div id="booking-modal" class="modal">
        <div class="modal-content">
            <span class="close-booking">&times;</span>
            <div id="booking-modal-body"></div>
        </div>
    </div>

    <!-- MAP MODAL -->
    <div id="map-modal" class="modal">
        <div class="map-modal-content">
            <div class="map-header">
                <h2>üìç Explore Stores in Erbil</h2>
                <button id="btn-confirm-location" class="btn-primary" style="display: none; margin-left: 10px;"
                    onclick="confirmLocationSelection()">‚úÖ Select This Location</button>
                <span class="close-map">&times;</span>
            </div>
            <div id="map-container"></div>
        </div>
    </div>

    <!-- STORE MODAL (Create/Edit) -->
    <div id="store-modal" class="modal">
        <div class="modal-content admin-modal">
            <span class="close-modal" onclick="closeModal('store-modal')">&times;</span>
            <h2 id="store-modal-title">Create New Store</h2>
            <form id="store-form">
                <input type="hidden" id="store-id">
                <div class="form-group">
                    <label>Store Name</label>
                    <input type="text" id="store-name" required placeholder="e.g. Glamour Salon">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Type</label>
                        <select id="store-type" required>
                            <option value="salon">Salon</option>
                            <option value="beauty_center">Beauty Center</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="store-category" required>
                            <option value="Hair Salon">Hair Salon</option>
                            <option value="Nail Salon">Nail Salon</option>
                            <option value="Barber Shop">Barber Shop</option>
                            <option value="Aesthetics">Aesthetics</option>
                            <option value="Skin Care">Skin Care</option>
                            <option value="Laser Center">Laser Center</option>
                            <option value="Makeup Studio">Makeup Studio</option>
                            <option value="Brows & Lashes">Brows & Lashes</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" id="store-address" required placeholder="e.g. Ankawa, Erbil">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Latitude</label>
                        <input type="number" id="store-lat" step="any" placeholder="e.g. 36.1901">
                    </div>
                    <div class="form-group">
                        <label>Longitude</label>
                        <input type="number" id="store-lng" step="any" placeholder="e.g. 44.0102">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button type="button" class="btn-secondary" onclick="openLocationPicker()"
                            style="margin-bottom: 2px;">üìç Pin on Map</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Store Photo</label>
                    <div class="photo-upload-container">
                        <img id="store-photo-preview" src="" alt="Store Preview"
                            style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px; display: none; margin-bottom: 10px; background: #eee;">
                        <input type="file" id="store-photo-file" accept="image/*" class="file-input">
                        <input type="hidden" id="store-photo">
                    </div>
                </div>

                <!-- Services Management Section (Only shown when editing) -->
                <div id="services-reorder-section" class="services-reorder-section" style="display: none;">
                    <div class="section-divider"></div>
                    <h3>üìã Manage Services</h3>
                    <p class="hint">Drag to reorder, click to edit, or add new services.</p>
                    <div id="services-sortable-list" class="sortable-list">
                        <!-- Services loaded via JS -->
                    </div>
                    <div class="services-actions">
                        <button type="button" class="btn-add-service" onclick="openAddServiceModal()">
                            ‚ûï Add New Service
                        </button>
                    </div>
                </div>

                <button type="submit" class="btn-primary full-width">Save Store</button>
            </form>
        </div>
    </div>

    <!-- USER ROLE MODAL -->
    <div id="user-role-modal" class="modal">
        <div class="modal-content admin-modal">
            <span class="close-modal" onclick="closeModal('user-role-modal')">&times;</span>
            <h2>Edit User Role</h2>
            <form id="user-role-form">
                <input type="hidden" id="edit-user-phone">
                <div class="form-group">
                    <label>User Name</label>
                    <input type="text" id="edit-user-name" readonly style="background: #f3f4f6;">
                </div>
                <div class="form-group">
                    <label>Select Role</label>
                    <select id="edit-user-role" required onchange="toggleStoreAssignment()">
                        <option value="customer">Customer</option>
                        <option value="owner">Store Owner</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div id="assign-store-group" class="form-group" style="display: none;">
                    <label>Assign Store</label>
                    <select id="edit-user-store">
                        <option value="">-- Select Store --</option>
                        <!-- Populated via JS -->
                    </select>
                    <p class="hint" style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                        Selecting a store will give this user full access to manage it.
                    </p>
                </div>
                <button type="submit" class="btn-primary full-width">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- OFFER MODAL -->
    <div id="offer-modal" class="modal">
        <div class="modal-content admin-modal">
            <span class="close-modal" onclick="closeModal('offer-modal')">&times;</span>
            <h2>Create New Offer</h2>
            <form id="offer-form">
                <div class="form-group">
                    <label>Select Store</label>
                    <select id="offer-store" required>
                        <!-- Populated via JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Select Service</label>
                    <select id="offer-service" required>
                        <!-- Populated via JS when store selected -->
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Discount %</label>
                        <input type="number" id="offer-discount" min="1" max="100" required placeholder="e.g. 20">
                    </div>
                    <div class="form-group">
                        <label>Duration (days)</label>
                        <input type="number" id="offer-duration" min="1" max="365" required placeholder="e.g. 7">
                    </div>
                </div>
                <button type="submit" class="btn-primary full-width">Create Offer</button>
            </form>
        </div>
    </div>

    <!-- SPONSOR MODAL -->
    <div id="sponsor-modal" class="modal">
        <div class="modal-content admin-modal">
            <span class="close-modal" onclick="closeModal('sponsor-modal')">&times;</span>
            <h2>Add Sponsor</h2>
            <form id="sponsor-form">
                <div class="form-group">
                    <label>Sponsor Type</label>
                    <select id="sponsor-type" onchange="toggleSponsorFields()">
                        <option value="store">Feature a Store</option>
                        <option value="external">External Advertisement</option>
                    </select>
                </div>
                <div id="sponsor-store-fields">
                    <div class="form-group">
                        <label>Select Store to Sponsor</label>
                        <select id="sponsor-store">
                            <!-- Populated via JS -->
                        </select>
                    </div>
                </div>
                <div id="sponsor-external-fields" style="display: none;">
                    <div class="form-group">
                        <label>Banner Image URL</label>
                        <input type="url" id="sponsor-image" placeholder="https://...">
                    </div>
                    <div class="form-group">
                        <label>Link URL</label>
                        <input type="url" id="sponsor-link" placeholder="https://...">
                    </div>
                    <div class="form-group">
                        <label>Title/Description</label>
                        <input type="text" id="sponsor-title" placeholder="e.g. Special Beauty Event">
                    </div>
                </div>
                <div class="form-group">
                    <label>Duration (days)</label>
                    <input type="number" id="sponsor-duration" min="1" max="365" required placeholder="e.g. 30">
                </div>
                <button type="submit" class="btn-primary full-width">Add Sponsor</button>
            </form>
        </div>
    </div>

    <!-- SERVICE MODAL (Edit/Add Service) -->
    <div id="service-modal" class="modal">
        <div class="modal-content admin-modal" style="max-width: 400px;">
            <span class="close-modal" onclick="closeModal('service-modal')">&times;</span>
            <h2 id="service-modal-title">Edit Service</h2>
            <form id="service-form">
                <input type="hidden" id="service-edit-index">
                <div class="form-group">
                    <label>Service Name</label>
                    <input type="text" id="service-edit-name" required placeholder="e.g. Haircut">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Price (IQD)</label>
                        <input type="number" id="service-edit-price" required min="0" placeholder="e.g. 25000">
                    </div>
                    <div class="form-group">
                        <label>Duration (mins)</label>
                        <input type="number" id="service-edit-duration" required min="5" placeholder="e.g. 30">
                    </div>
                </div>
                <button type="submit" class="btn-primary full-width">Save Service</button>
            </form>
        </div>
    </div>

    <!-- INVOICE MODAL -->
    <div id="invoice-modal" class="modal">
        <div class="modal-content invoice-modal">
            <span class="close-modal" onclick="closeModal('invoice-modal')">&times;</span>
            <div id="invoice-content" class="invoice">
                <div class="invoice-header">
                    <div class="invoice-logo">
                        <h1>üìÖ DocBook</h1>
                        <p>Beauty & Wellness Platform</p>
                    </div>
                    <div class="invoice-title">
                        <h2>COMMISSION INVOICE</h2>
                        <p id="invoice-number">#INV-000001</p>
                    </div>
                </div>

                <div class="invoice-meta">
                    <div class="invoice-from">
                        <strong>From:</strong>
                        <p>DocBook Platform</p>
                        <p>Erbil, Kurdistan Region, Iraq</p>
                        <p>info@docbook.iq</p>
                    </div>
                    <div class="invoice-to">
                        <strong>Bill To:</strong>
                        <p id="invoice-store-name">Store Name</p>
                        <p id="invoice-store-address">Store Address</p>
                        <p id="invoice-period">Period: January 2026</p>
                    </div>
                </div>

                <table class="invoice-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Service</th>
                            <th>Customer</th>
                            <th>Service Amount</th>
                            <th>Commission (10%)</th>
                        </tr>
                    </thead>
                    <tbody id="invoice-items">
                        <!-- Filled via JS -->
                    </tbody>
                </table>

                <div class="invoice-totals">
                    <div class="invoice-total-row">
                        <span>Total Services:</span>
                        <span id="invoice-service-count">0</span>
                    </div>
                    <div class="invoice-total-row">
                        <span>Gross Revenue:</span>
                        <span id="invoice-gross">0 IQD</span>
                    </div>
                    <div class="invoice-total-row commission">
                        <span>Platform Commission (10%):</span>
                        <span id="invoice-commission">0 IQD</span>
                    </div>
                    <div class="invoice-total-row grand">
                        <span>Amount Due:</span>
                        <span id="invoice-total">0 IQD</span>
                    </div>
                </div>

                <div class="invoice-paid-stamp" id="invoice-stamp">
                    ‚úì PAID
                </div>

                <div class="invoice-footer">
                    <p>Payment due within 30 days of invoice date.</p>
                    <p class="invoice-note">Generated on <span id="invoice-generated-date"></span></p>
                </div>
            </div>
            <div class="invoice-actions">
                <button class="btn-primary" onclick="saveInvoice()" id="btn-save-invoice">üíæ Save Invoice</button>
                <button class="btn-primary" onclick="printInvoice()">‚¨áÔ∏è Download / Print</button>
                <button class="btn-secondary" id="btn-mark-paid" onclick="markInvoicePaid()">‚úì Mark as Paid</button>
                <button class="btn-secondary" onclick="closeModal('invoice-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="custom-confirm-modal" class="modal">
        <div class="modal-content auth-box">
            <h3 style="margin-bottom: 10px; color: var(--text);">Confirmation</h3>
            <p id="confirm-message" style="color: var(--text-light); margin-bottom: 20px;">Are you sure?</p>
            <div class="confirm-modal-buttons">
                <button class="btn-outline" id="btn-confirm-cancel">Cancel</button>
                <button class="btn-primary" id="btn-confirm-ok">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <footer>
        <div class="container">
            <p>&copy; 2026 DocBook. All rights reserved.</p>
        </div>
    </footer>
</body>

</html>